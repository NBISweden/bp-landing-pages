{{- $variable := .Get "variable" -}}
<div data-pagefind-body >
    {{ $data := index .Site.Data.datasets $variable }}
    {{ if $data }}
    <!--Indexing subset of attributes-->
    {{ $stringAttributes := index $data.LANDING_PAGE.ATTRIBUTES.STRING_ATTRIBUTE }}
    {{ $setAttributes := index $data.LANDING_PAGE.ATTRIBUTES.SET_ATTRIBUTE }}
    {{ $numAttributes := index $data.LANDING_PAGE.ATTRIBUTES.NUMERIC_ATTRIBUTE }}
  <!--Header-->
    {{ range $rte := where $stringAttributes "TAG"  "header" }}
    <h2>{{ index $rte "VALUE" }}</h2>
        {{end}}
    <!--Keywords-->
    {{range $rte := where $setAttributes "TAG" "keywords"}}
    {{range $er := index $rte.VALUE.STRING_ATTRIBUTE}}{{.VALUE}},{{end}}
    {{end}}
    <table>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "dataset_name" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "dataset_short_name" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "doi" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "animal_species" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "anatomical_site" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        {{$medicalDiagnosis := where $stringAttributes "TAG" "medical_diagnosis"}}
        {{if gt (len $medicalDiagnosis) 0}}
            <tr>
                <td>{{ replaceRE `(_{1,})` " " (index $medicalDiagnosis 0).TAG }}</td>
                <td>
                    {{ $length := len $medicalDiagnosis }}
                    {{ range $index, $rte := $medicalDiagnosis }}
                        {{ index $rte "VALUE" }}{{ if ne $index (sub $length 1) }}, {{ end }}
                    {{ end }}
                </td>
            </tr>
        {{end}}
        
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "number_of_wsis" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "number_of_cases" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "number_of_biological_beings" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "number_of_observations" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "dataset_size" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $setAttributes "TAG"  "age_at_extractions" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>
                    {{ range index $rte.VALUE.STRING_ATTRIBUTE }}
                    {{.VALUE}}
                    {{end}}
                    </td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "geographical_area" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "extraction_method" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "specimen_type" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "image_type" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "image_resolution" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "number_of_annotations" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $numAttributes "TAG"  "year_of_submission" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "dataset_version" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "metadata_standard_version" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "center_name" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "cite_as" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
            <tr>
                {{ range $rte := where $stringAttributes "TAG"  "reference" }}
                    <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                    <td>{{ index $rte "VALUE" }}</td>
                {{end }}
            </tr>
    </table>
    {{ else }}
        <p>Data for '{{ $variable }}' not found.</p>
    {{ end }}
    
    <h2>Comments</h2>

    <h2>Terms of use</h2>
    {{ $stringAttributes := index $data.LANDING_PAGE.ATTRIBUTES.STRING_ATTRIBUTE }}
    {{ $setAttributes := index $data.LANDING_PAGE.ATTRIBUTES.SET_ATTRIBUTE }}
    <table>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "type_of_access" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $stringAttributes "TAG"  "permitted_use_or_purpose" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $setAttributes "TAG"  "use_restrictions" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>
                {{ range index $rte.VALUE.STRING_ATTRIBUTE }}
                {{.VALUE}}
                {{end}}
                </td>
            {{end }}
        </tr>
        <tr>
            {{ range $rte := where $setAttributes "TAG"  "allowed_geographical_distribution" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>
                {{ range index $rte.VALUE.STRING_ATTRIBUTE }}
                {{.VALUE}} 
                {{end}}
                </td>
            {{end }}
        </tr>       
         <tr>
            {{ range $rte := where $stringAttributes "TAG"  "access_duration" }}
                <td>{{ replaceRE `(_{1,})` " " .TAG }}</td>
                <td>{{ index $rte "VALUE" }}</td>
            {{end }}
        </tr>
    </table>

   <h2><a href = "{{$data.LANDING_PAGE.REMS_ACCESS_LINK}}">Apply for access</a> </h2>
</div>
